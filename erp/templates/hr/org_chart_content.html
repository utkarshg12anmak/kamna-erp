<!-- HR Organizational Chart Content Template -->
<style>
    .org-chart {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        position: relative;
    }
    
    .org-node {
        background: white;
        border: 2px solid #3C83F6;
        border-radius: 8px;
        padding: 15px;
        margin: 10px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        position: relative;
        min-width: 200px;
    }
    
    .org-node:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .org-node.ceo {
        border-color: #dc3545;
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
    }
    
    .org-node.manager {
        border-color: #28a745;
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        color: white;
    }
    
    .org-node.employee {
        border-color: #3C83F6;
        background: linear-gradient(135deg, #3C83F6 0%, #2563eb 100%);
        color: white;
    }
    
    .employee-photo {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        margin: 0 auto 10px;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: #6c757d;
    }
    
    .employee-name {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 5px;
    }
    
    .employee-title {
        font-size: 14px;
        opacity: 0.9;
        margin-bottom: 5px;
    }
    
    .employee-department {
        font-size: 12px;
        opacity: 0.8;
    }
    
    .org-level {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin: 30px 0;
    }
    
    .org-stats {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .stat-card {
        text-align: center;
        padding: 15px;
        border-radius: 8px;
        background: linear-gradient(135deg, #3C83F6 0%, #2563eb 100%);
        color: white;
    }
    
    .stat-number {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        opacity: 0.9;
    }
    
    .org-actions {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .org-node.highlighted {
        border-color: #ffc107 !important;
        box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.3);
    }
    
    .org-node.compact {
        min-width: 150px;
        padding: 10px;
        margin: 5px;
    }
    
    .org-node.compact .employee-photo {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .org-node.compact .employee-name {
        font-size: 14px;
    }
    
    .org-node.compact .employee-title {
        font-size: 12px;
    }
    
    @media print {
        .org-actions, .btn {
            display: none !important;
        }
        
        .org-chart {
            background: white !important;
            box-shadow: none !important;
        }
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-sitemap text-primary"></i> Organizational Chart</h2>
        <p class="text-muted mb-0">Company structure and hierarchy visualization</p>
    </div>
    <div>
        <button class="btn btn-outline-primary" onclick="window.print()">
            <i class="fas fa-print"></i> Print Chart
        </button>
        <a href="/app/hr/employees" class="btn btn-primary">
            <i class="fas fa-users"></i> Employee List
        </a>
    </div>
</div>

<!-- Organization Statistics -->
<div class="org-stats">
    <div class="row">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-number" id="totalEmployees">24</div>
                <div class="stat-label">Total Employees</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);">
                <div class="stat-number" id="totalManagers">8</div>
                <div class="stat-label">Managers</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
                <div class="stat-number" id="totalDepartments">5</div>
                <div class="stat-label">Departments</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);">
                <div class="stat-number" id="avgTeamSize">3.2</div>
                <div class="stat-label">Avg Team Size</div>
            </div>
        </div>
    </div>
</div>

<!-- View Controls -->
<div class="org-actions">
    <div class="row align-items-center">
        <div class="col-md-4">
            <label class="form-label"><strong>View Type:</strong></label>
            <select class="form-select" id="viewType" onchange="changeView()">
                <option value="hierarchy">Hierarchy View</option>
                <option value="department">Department View</option>
                <option value="compact">Compact View</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label"><strong>Department Filter:</strong></label>
            <select class="form-select" id="departmentFilter" onchange="filterDepartment()">
                <option value="">All Departments</option>
                <option value="executive">Executive</option>
                <option value="hr">Human Resources</option>
                <option value="finance">Finance</option>
                <option value="it">Information Technology</option>
                <option value="sales">Sales & Marketing</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label"><strong>Search Employee:</strong></label>
            <input type="text" class="form-control" id="employeeSearch" 
                   placeholder="Search by name or position..." onkeyup="searchEmployee()">
        </div>
    </div>
</div>

<!-- Organizational Chart -->
<div class="org-chart" id="orgChart">
    <!-- CEO Level -->
    <div class="org-level">
        <div class="org-node ceo" data-department="executive" data-name="sarah wilson" data-position="ceo">
            <div class="employee-photo">
                <i class="fas fa-user-tie"></i>
            </div>
            <div class="employee-name">Sarah Wilson</div>
            <div class="employee-title">Chief Executive Officer</div>
            <div class="employee-department">Executive</div>
        </div>
    </div>

    <!-- Department Heads Level -->
    <div class="org-level">
        <div class="org-node manager" data-department="hr" data-name="michael chen" data-position="hr director">
            <div class="employee-photo">
                <i class="fas fa-user-friends"></i>
            </div>
            <div class="employee-name">Michael Chen</div>
            <div class="employee-title">HR Director</div>
            <div class="employee-department">Human Resources</div>
        </div>
        
        <div class="org-node manager" data-department="finance" data-name="jessica taylor" data-position="cfo">
            <div class="employee-photo">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="employee-name">Jessica Taylor</div>
            <div class="employee-title">Chief Financial Officer</div>
            <div class="employee-department">Finance</div>
        </div>
        
        <div class="org-node manager" data-department="it" data-name="david kumar" data-position="cto">
            <div class="employee-photo">
                <i class="fas fa-laptop-code"></i>
            </div>
            <div class="employee-name">David Kumar</div>
            <div class="employee-title">Chief Technology Officer</div>
            <div class="employee-department">Information Technology</div>
        </div>
        
        <div class="org-node manager" data-department="sales" data-name="emily rodriguez" data-position="sales director">
            <div class="employee-photo">
                <i class="fas fa-handshake"></i>
            </div>
            <div class="employee-name">Emily Rodriguez</div>
            <div class="employee-title">Sales Director</div>
            <div class="employee-department">Sales & Marketing</div>
        </div>
    </div>

    <!-- Team Members Level -->
    <div class="org-level">
        <!-- HR Team -->
        <div class="org-node employee" data-department="hr" data-name="robert johnson" data-position="hr specialist">
            <div class="employee-photo">
                <i class="fas fa-user"></i>
            </div>
            <div class="employee-name">Robert Johnson</div>
            <div class="employee-title">HR Specialist</div>
            <div class="employee-department">Human Resources</div>
        </div>
        
        <div class="org-node employee" data-department="hr" data-name="lisa brown" data-position="recruiter">
            <div class="employee-photo">
                <i class="fas fa-user"></i>
            </div>
            <div class="employee-name">Lisa Brown</div>
            <div class="employee-title">Recruiter</div>
            <div class="employee-department">Human Resources</div>
        </div>

        <!-- Finance Team -->
        <div class="org-node employee" data-department="finance" data-name="tom wilson" data-position="accountant">
            <div class="employee-photo">
                <i class="fas fa-calculator"></i>
            </div>
            <div class="employee-name">Tom Wilson</div>
            <div class="employee-title">Senior Accountant</div>
            <div class="employee-department">Finance</div>
        </div>
        
        <div class="org-node employee" data-department="finance" data-name="maria garcia" data-position="analyst">
            <div class="employee-photo">
                <i class="fas fa-chart-bar"></i>
            </div>
            <div class="employee-name">Maria Garcia</div>
            <div class="employee-title">Financial Analyst</div>
            <div class="employee-department">Finance</div>
        </div>

        <!-- IT Team -->
        <div class="org-node employee" data-department="it" data-name="james lee" data-position="developer">
            <div class="employee-photo">
                <i class="fas fa-code"></i>
            </div>
            <div class="employee-name">James Lee</div>
            <div class="employee-title">Senior Developer</div>
            <div class="employee-department">Information Technology</div>
        </div>
        
        <div class="org-node employee" data-department="it" data-name="anna smith" data-position="designer">
            <div class="employee-photo">
                <i class="fas fa-palette"></i>
            </div>
            <div class="employee-name">Anna Smith</div>
            <div class="employee-title">UI/UX Designer</div>
            <div class="employee-department">Information Technology</div>
        </div>

        <!-- Sales Team -->
        <div class="org-node employee" data-department="sales" data-name="chris martinez" data-position="sales rep">
            <div class="employee-photo">
                <i class="fas fa-phone"></i>
            </div>
            <div class="employee-name">Chris Martinez</div>
            <div class="employee-title">Sales Representative</div>
            <div class="employee-department">Sales & Marketing</div>
        </div>
        
        <div class="org-node employee" data-department="sales" data-name="kelly davis" data-position="marketing manager">
            <div class="employee-photo">
                <i class="fas fa-bullhorn"></i>
            </div>
            <div class="employee-name">Kelly Davis</div>
            <div class="employee-title">Marketing Manager</div>
            <div class="employee-department">Sales & Marketing</div>
        </div>
    </div>
</div>

<!-- Legend -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <h6 class="card-title">Legend</h6>
                <div class="row">
                    <div class="col-md-3">
                        <div class="d-flex align-items-center mb-2">
                            <div class="org-node ceo me-3" style="transform: scale(0.3); margin: 0;">
                                <div class="employee-photo"><i class="fas fa-user-tie"></i></div>
                            </div>
                            <span>Executive Level</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-flex align-items-center mb-2">
                            <div class="org-node manager me-3" style="transform: scale(0.3); margin: 0;">
                                <div class="employee-photo"><i class="fas fa-user-friends"></i></div>
                            </div>
                            <span>Management Level</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-flex align-items-center mb-2">
                            <div class="org-node employee me-3" style="transform: scale(0.3); margin: 0;">
                                <div class="employee-photo"><i class="fas fa-user"></i></div>
                            </div>
                            <span>Employee Level</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i> 
                            Click on any employee to view details
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize org chart
    initializeOrgChart();
    
    // Add click handlers for employee nodes
    document.querySelectorAll('.org-node').forEach(node => {
        node.addEventListener('click', function() {
            showEmployeeDetails(this);
        });
    });
});

function initializeOrgChart() {
    // Load organization data
    updateStats();
}

function updateStats() {
    // Update statistics
    const nodes = document.querySelectorAll('.org-node');
    const managers = document.querySelectorAll('.org-node.manager, .org-node.ceo');
    const departments = new Set();
    
    nodes.forEach(node => {
        const dept = node.getAttribute('data-department');
        if (dept) departments.add(dept);
    });
    
    const stats = {
        totalEmployees: nodes.length,
        totalManagers: managers.length,
        totalDepartments: departments.size,
        avgTeamSize: managers.length > 0 ? (nodes.length / managers.length).toFixed(1) : '0'
    };
    
    document.getElementById('totalEmployees').textContent = stats.totalEmployees;
    document.getElementById('totalManagers').textContent = stats.totalManagers;
    document.getElementById('totalDepartments').textContent = stats.totalDepartments;
    document.getElementById('avgTeamSize').textContent = stats.avgTeamSize;
}

function changeView() {
    const viewType = document.getElementById('viewType').value;
    const chart = document.getElementById('orgChart');
    
    chart.classList.remove('hierarchy-view', 'department-view', 'compact-view');
    chart.classList.add(viewType + '-view');
    
    switch(viewType) {
        case 'hierarchy':
            showHierarchyView();
            break;
        case 'department':
            showDepartmentView();
            break;
        case 'compact':
            showCompactView();
            break;
    }
}

function showHierarchyView() {
    // Default hierarchy view - already implemented
    document.querySelectorAll('.org-level').forEach(level => {
        level.style.display = 'flex';
    });
    document.querySelectorAll('.org-node').forEach(node => {
        node.style.display = 'block';
    });
}

function showDepartmentView() {
    // Group by departments
    const departments = {};
    document.querySelectorAll('.org-node').forEach(node => {
        const dept = node.getAttribute('data-department');
        if (!departments[dept]) {
            departments[dept] = [];
        }
        departments[dept].push(node);
    });
    
    // Reorganize display by departments
    let html = '';
    Object.keys(departments).forEach(dept => {
        html += '<div class="department-group">' +
                '<h5 class="text-primary text-center mb-3">' + dept.toUpperCase() + '</h5>' +
                '<div class="org-level">';
        departments[dept].forEach(node => {
            html += node.outerHTML;
        });
        html += '</div></div>';
    });
    
    document.getElementById('orgChart').innerHTML = html;
    
    // Re-add click handlers
    document.querySelectorAll('.org-node').forEach(node => {
        node.addEventListener('click', function() {
            showEmployeeDetails(this);
        });
    });
}

function showCompactView() {
    // Compact view with smaller nodes
    document.querySelectorAll('.org-node').forEach(node => {
        node.classList.add('compact');
    });
}

function filterDepartment() {
    const department = document.getElementById('departmentFilter').value;
    
    if (department === '') {
        document.querySelectorAll('.org-node').forEach(node => {
            node.style.display = 'block';
        });
    } else {
        document.querySelectorAll('.org-node').forEach(node => {
            if (node.getAttribute('data-department') === department) {
                node.style.display = 'block';
            } else {
                node.style.display = 'none';
            }
        });
    }
    
    updateStats();
}

function searchEmployee() {
    const searchTerm = document.getElementById('employeeSearch').value.toLowerCase();
    
    if (searchTerm === '') {
        document.querySelectorAll('.org-node').forEach(node => {
            node.style.display = 'block';
            node.classList.remove('highlighted');
        });
    } else {
        document.querySelectorAll('.org-node').forEach(node => {
            const name = node.getAttribute('data-name');
            const position = node.getAttribute('data-position');
            
            if (name.includes(searchTerm) || position.includes(searchTerm)) {
                node.style.display = 'block';
                node.classList.add('highlighted');
            } else {
                node.style.display = 'none';
                node.classList.remove('highlighted');
            }
        });
    }
}

function showEmployeeDetails(node) {
    const employeeData = {
        name: node.querySelector('.employee-name').textContent,
        title: node.querySelector('.employee-title').textContent,
        department: node.querySelector('.employee-department').textContent
    };
    
    // Show employee details modal or redirect to employee page
    if (window.notify) {
        window.notify(
            `Employee: ${employeeData.name}\nTitle: ${employeeData.title}\nDepartment: ${employeeData.department}`,
            'info'
        );
    } else {
        alert('Employee: ' + employeeData.name + '\nTitle: ' + employeeData.title + '\nDepartment: ' + employeeData.department);
    }
}
</script>
