<div>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h5 m-0">Partners</h2>
    <a class="btn btn-primary btn-sm" href="/app/partners/new">New Partner</a>
  </div>
  <div class="input-group mb-3">
    <input id="q" type="text" class="form-control" placeholder="Search partners by name, email, phone...">
    <button id="searchBtn" class="btn btn-outline-secondary">Search</button>
  </div>
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead>
        <tr><th>Name</th><th>Type</th><th>Status</th><th>Roles</th><th></th></tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>
<script>
(async function(){
  const token = localStorage.getItem('accessToken');
  async function load(q=""){
    const url = new URL('/api/partners/partners/', window.location.origin);
    if(q) url.searchParams.set('search', q);
    const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
    if(!res.ok){ notify('Failed to load partners', 'error'); return; }
    const data = await res.json();
    const list = Array.isArray(data) ? data : data.results;
    const tbody = document.getElementById('rows');
    tbody.innerHTML = '';
    for(const p of list){
      const tr = document.createElement('tr');
      const roles = [p.is_customer? 'Customer': null, p.is_vendor? 'Vendor': null, p.is_carrier? 'Carrier': null, p.is_employee? 'Employee': null].filter(Boolean).join(', ');
      tr.innerHTML = `<td>${p.name}</td><td>${p.type}</td><td>${p.status}</td><td>${roles}</td>
        <td class="text-end"><a class="btn btn-sm btn-outline-primary" href="/app/partners/${p.id}">View</a></td>`;
      tbody.appendChild(tr);
    }
  }
  document.getElementById('searchBtn').addEventListener('click', ()=> load(document.getElementById('q').value.trim()));
  load();
})();
</script>
