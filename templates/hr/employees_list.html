<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Employees</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root { --primary:#3C83F6; }
    body { background:#f5f6f8; }
    .btn-primary{ background:var(--primary); border-color:var(--primary); }
    .card-like{ background:#fff; border-radius:14px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,.08);}    
    .avatar{ width:40px; height:40px; object-fit:cover; border-radius:50%; }
  </style>
</head>
<body>
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Employees</h1>
    <a href="/app/hr/employees/new" class="btn btn-primary">Add Employee</a>
  </div>
  <div class="card-like mb-3">
    <form id="filterForm" class="row g-2">
      <div class="col-md-3"><input type="text" class="form-control" name="search" placeholder="Search name, code, phone"></div>
      <div class="col-md-2"><select name="status" class="form-select"><option value="">All Status</option><option>ACTIVE</option><option>ON_LEAVE</option><option>INACTIVE</option><option>EXITED</option></select></div>
      <div class="col-md-2"><input type="text" name="department" class="form-control" placeholder="Department"></div>
      <div class="col-md-2"><input type="text" name="designation" class="form-control" placeholder="Designation"></div>
      <div class="col-md-1"><input type="date" name="doj_from" class="form-control" title="DOJ From"></div>
      <div class="col-md-1"><input type="date" name="doj_to" class="form-control" title="DOJ To"></div>
      <div class="col-md-1 d-grid"><button class="btn btn-outline-secondary">Go</button></div>
    </form>
  </div>
  <div class="card-like">
    <div class="table-responsive">
      <table class="table table-sm align-middle" id="empTable">
        <thead><tr><th>Photo</th><th>Name</th><th>Emp Code</th><th>Email / Phone</th><th>Department</th><th>Designation</th><th>DoJ</th><th>Status</th><th>Aadhaar</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
<script>
async function fetchEmployees(){
  const params = new URLSearchParams();
  const f = document.getElementById('filterForm');
  const search = f.search.value.trim(); if(search) params.append('search', search);
  if(f.status.value) params.append('status', f.status.value);
  if(f.department.value) params.append('department', f.department.value);
  if(f.designation.value) params.append('designation', f.designation.value);
  if(f.doj_from.value) params.append('date_of_joining__gte', f.doj_from.value);
  if(f.doj_to.value) params.append('date_of_joining__lte', f.doj_to.value);
  const resp = await fetch('/api/hr/employees/?'+params.toString(), {headers:{'Accept':'application/json'}});
  const data = await resp.json();
  const tbody = document.querySelector('#empTable tbody');
  tbody.innerHTML='';
  (data.results||data||[]).forEach(row=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${row.profile_image?`<img src='${row.profile_image}' class='avatar'/>`:''}</td>
      <td>${row.full_name||''}</td>
      <td>${row.emp_code||''}</td>
      <td><div>${row.email||''}</div><div class='text-muted small'>${row.phone||''}</div></td>
      <td>${row.department||''}</td>
      <td>${row.designation||''}</td>
      <td>${row.date_of_joining||''}</td>
      <td><span class='badge bg-secondary'>${row.status}</span></td>
      <td>${row.aadhaar_masked||''}</td>
      <td><div class='btn-group btn-group-sm'>
         <a class='btn btn-outline-primary' href='/app/hr/employees/${row.id}'>Edit</a>
         <button class='btn btn-outline-danger' onclick='softDelete(${row.id})' type='button'>Soft Delete</button>
      </div></td>`;
    tbody.appendChild(tr);
  });
}
async function softDelete(id){
  if(!confirm('Mark employee EXITED?')) return;
  const resp = await fetch(`/api/hr/employees/${id}/soft_delete/`,{method:'POST'});
  if(resp.ok) fetchEmployees();
  else alert('Failed');
}
fetchEmployees();

document.getElementById('filterForm').addEventListener('submit', e=>{e.preventDefault(); fetchEmployees();});
</script>
</body>
</html>
